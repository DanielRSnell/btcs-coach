import{r as c,u as U,j as e,H as R,L as q,a as Y}from"./app-CHErqvc6.js";import{A as G,M as Q,T as W,f as X,g as E,h as I,D as Z,a as ee,b as se,c as te,d as ae,e as le}from"./app-layout-CD4riDtw.js";import{c as S,B as h}from"./app-logo-icon-B0h-Ut6k.js";import{C as p,a as g,c as f,b as N,d as M}from"./card-Drk4hI3b.js";import{B as r}from"./badge-spqRmgFe.js";import{M as ie}from"./mic-DrlHyPT1.js";import{C as L}from"./clock-DWMNTkQm.js";import{T as C}from"./target-WIiemIM8.js";import{B as V}from"./book-open-BPlj3Fmn.js";import{m as ce}from"./proxy-BmwacoQH.js";import{C as ne}from"./circle-check-big-BiYTsfx-.js";/* empty css            */import"./index-CR-cSDcI.js";import"./label-CaCr2IvL.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],oe=S("ArrowLeft",re);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],xe=S("CircleAlert",de);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],he=S("Circle",me),pe={coaching:"bg-green-100 text-green-800",training:"bg-yellow-100 text-yellow-800",assessment:"bg-blue-100 text-blue-800"},ge={beginner:"bg-emerald-100 text-emerald-800",intermediate:"bg-amber-100 text-amber-800",advanced:"bg-red-100 text-red-800"},O={low:"bg-blue-100 text-blue-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-red-100 text-red-800"},z=a=>{switch(a){case"completed":return e.jsx(ne,{className:"h-4 w-4 text-green-500"});case"in_progress":return e.jsx(xe,{className:"h-4 w-4 text-yellow-500"});default:return e.jsx(he,{className:"h-4 w-4 text-gray-400"})}};function De({module:a,user:s,actionItems:k=[]}){const[l,v]=c.useState(null),[B,u]=c.useState(!1),[A,o]=c.useState(!1),[d,T]=c.useState("voiceflow"),$=c.useRef(null),{props:H}=U(),b=H.flash?.success;c.useEffect(()=>{b&&console.log("Success:",b)},[b]);const P=t=>{v(t),u(!0)},F=()=>{u(!1),v(null),o(!1)},J=()=>{l&&(o(!0),Y.put(`/action-items/${l.id}/complete`,{},{preserveState:!1,preserveScroll:!0,onSuccess:t=>{u(!1),v(null),o(!1),console.log("Action item marked as completed successfully")},onError:t=>{console.error("Failed to update action item:",t),alert("Failed to update action item. Please try again."),o(!1)},onFinish:()=>{o(!1)}}))};c.useEffect(()=>{if(!document.querySelector('script[src*="convai-widget-embed"]')){const t=document.createElement("script");t.src="https://unpkg.com/@elevenlabs/convai-widget-embed",t.async=!0,t.type="text/javascript",document.head.appendChild(t)}},[]);const D={user_profile:JSON.stringify({id:s?.id||0,name:s?.name||"Anonymous",email:s?.email||"",role:s?.role||"member",pi_behavioral_pattern_id:s?.pi_behavioral_pattern_id||null,pi_behavioral_pattern:s?.pi_behavioral_pattern||null,pi_raw_scores:s?.pi_raw_scores||null,pi_assessed_at:s?.pi_assessed_at||null,pi_notes:s?.pi_notes||null,pi_profile:s?.pi_profile||null,has_pi_assessment:s?.has_pi_assessment||!1,has_pi_profile:s?.has_pi_profile||!1}),user_name:s?.name?s.name.split(" ")[0]:"Anonymous"};return console.log("ðŸš€ ElevenLabs Variables Structure:",D),console.log("ðŸš€ ElevenLabs Final JSON:",JSON.stringify(D)),c.useEffect(()=>{const t=()=>{setTimeout(()=>{console.log("Starting Voiceflow initialization...");const w=document.getElementById("btcs-chat");console.log("Chat element found:",w);let y=[];try{const n=Object.keys(localStorage).filter(i=>i.includes("cmeu"));if(console.log('ðŸ” Checking for localStorage keys containing "cmeu":',n),n.length>0){const i=n[0],m=localStorage.getItem(i);if(m){console.log(`ðŸ“¦ Found cmeu data in key "${i}"`);const _=JSON.parse(m);_.turns&&Array.isArray(_.turns)?(y=_.turns,console.log(`âœ… Extracted ${y.length} turns from cmeu localStorage:`,y)):console.log("âš ï¸ No turns array found in cmeu data")}else console.log(`âš ï¸ No data found for cmeu key "${i}"`)}else console.log('ðŸ“­ No localStorage keys containing "cmeu" found')}catch(x){console.error("âŒ Error extracting voicechat_history from localStorage:",x)}const K={id:s?.id||0,name:s?.name||"Anonymous",email:s?.email||"",role:s?.role||"member",pi_behavioral_pattern_id:s?.pi_behavioral_pattern_id||null,pi_behavioral_pattern:s?.pi_behavioral_pattern||null,pi_raw_scores:s?.pi_raw_scores||null,pi_assessed_at:s?.pi_assessed_at||null,pi_notes:s?.pi_notes||null,pi_profile:s?.pi_profile||null,has_pi_assessment:s?.has_pi_assessment||!1,has_pi_profile:s?.has_pi_profile||!1,voicechat_history:y};console.log("ðŸš€ Voiceflow User Payload:",JSON.stringify(K,null,2)),function(x,n){const i=x.createElement(n),m=x.getElementsByTagName(n)[0];i.onload=function(){console.log("Voiceflow script loaded, window.voiceflow:",window.voiceflow),console.log("Voiceflow chat loaded for module:",a.title)},i.src="https://cdn.voiceflow.com/widget-next/bundle.mjs",i.type="text/javascript",m.parentNode.insertBefore(i,m)}(document,"script")},100),console.log("Voiceflow initialization started for module:",a.title)},j=()=>{if(window.voiceflow&&window.voiceflow.chat)try{window.voiceflow.chat.destroy(),console.log("Voiceflow chat destroyed")}catch(w){console.warn("Error cleaning up Voiceflow:",w)}};return j(),t(),j},[a,s]),e.jsxs(G,{children:[e.jsx(R,{title:`${a.title} - Interactive Session`}),e.jsxs("div",{className:"flex gap-6",style:{height:"calc(100vh - 200px)"},children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx(q,{href:"/modules",children:e.jsxs(h,{variant:"outline",size:"sm",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Back to Modules"]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600",children:"Interactive Coaching Session"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"outline",size:"sm",children:"Save Progress"}),e.jsx(h,{variant:"outline",size:"sm",children:"End Session"})]})]}),e.jsxs(p,{className:"flex-1 flex flex-col py-0",style:{minHeight:"500px",maxHeight:"calc(100vh - 280px)"},children:[e.jsx(g,{className:"py-3 px-4 border-b",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{onClick:()=>T("voiceflow"),className:`inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${d==="voiceflow"?"bg-blue-100 text-blue-700 border-blue-200 border":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Q,{className:"h-4 w-4"}),"Text Chat"]}),e.jsxs("button",{onClick:()=>T("elevenlabs"),className:`inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${d==="elevenlabs"?"bg-green-100 text-green-700 border-green-200 border":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(ie,{className:"h-4 w-4"}),"Voice Chat"]})]}),e.jsx("div",{className:"text-sm text-gray-500 ml-auto",children:d==="voiceflow"?"Text-based coaching conversation":"Voice-based AI coaching"})]})}),e.jsxs(f,{className:"p-0 flex-1 relative",children:[e.jsx("div",{id:"btcs-chat",className:`w-full h-full ${d==="voiceflow"?"block":"hidden"}`,style:{maxHeight:"calc(100vh - 200px)"},children:e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"w-8 h-8 bg-blue-200 rounded-full mx-auto mb-4"})}),e.jsx("p",{children:"Initializing your coaching session..."}),e.jsx("p",{className:"text-sm mt-2",children:"Your AI coach will appear here shortly."})]})})}),d==="elevenlabs"&&e.jsx("div",{className:"w-full h-full",children:e.jsx("div",{className:"w-full h-full relative",children:e.jsx("elevenlabs-convai",{ref:$,"agent-id":"agent_0901k31ke64mf0w8me1gdwygb7ze",style:{position:"relative",width:"100%",height:"100%",display:"block"}})})})]})]})]}),e.jsx("div",{className:"w-80",children:e.jsxs(W,{defaultValue:"info",className:"w-full",children:[e.jsxs(X,{className:"grid w-full grid-cols-2",children:[e.jsx(E,{value:"info",children:"Info"}),e.jsx(E,{value:"actions",children:"Actions"})]}),e.jsxs(I,{value:"info",className:"space-y-4 mt-4",children:[e.jsxs(p,{children:[e.jsxs(g,{className:"pb-3",children:[e.jsx(N,{className:"text-lg",children:a.title}),e.jsx(M,{className:"text-sm",children:a.description})]}),e.jsxs(f,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:pe[a.type],children:a.type}),e.jsx(r,{variant:"outline",className:ge[a.difficulty],children:a.difficulty})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs("span",{children:[a.estimated_duration," minutes"]})]})]})]}),e.jsxs(p,{children:[e.jsx(g,{className:"pb-3",children:e.jsxs(N,{className:"flex items-center gap-2 text-lg",children:[e.jsx(C,{className:"h-5 w-5"}),"Session Overview"]})}),e.jsxs(f,{className:"space-y-4",children:[a.topics&&a.topics.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(V,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Key Topics:"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a.topics.map((t,j)=>e.jsx(r,{variant:"secondary",className:"text-xs",children:t},j))})]}),a.learning_objectives&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Learning Objectives:"})]}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:a.learning_objectives})]})]})]}),e.jsxs(p,{children:[e.jsx(g,{className:"pb-3",children:e.jsx(N,{className:"text-lg",children:"Session Progress"})}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Status"}),e.jsx("span",{className:"font-medium text-green-600",children:"In Progress"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Started"}),e.jsx("span",{className:"font-medium",children:"Just now"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Estimated Time"}),e.jsxs("span",{className:"font-medium",children:[a.estimated_duration," min"]})]})]})})]})]}),e.jsx(I,{value:"actions",className:"space-y-4 mt-4",children:e.jsxs(p,{children:[e.jsxs(g,{className:"pb-3",children:[e.jsx(N,{className:"text-lg",children:"Module Action Items"}),e.jsxs(M,{className:"text-sm",children:["Your personalized tasks and objectives for ",a.title]})]}),e.jsx(f,{children:k.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(C,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No action items for this module yet"}),e.jsx("p",{className:"text-xs mt-1",children:"Complete coaching sessions to generate personalized tasks"})]}):e.jsx("div",{className:"space-y-3",children:k.map(t=>e.jsxs(ce.div,{className:"border rounded-lg p-3 space-y-2 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>P(t),whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsxs("div",{className:"flex items-start gap-2",children:[z(t.status),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:t.title}),e.jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:t.description})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(r,{variant:"outline",className:`text-xs ${O[t.priority]}`,children:t.priority}),t.due_date&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Due ",new Date(t.due_date).toLocaleDateString()]})]}),t.context&&e.jsx("div",{className:"text-xs text-gray-500 italic truncate",children:t.context})]},t.id))})})]})})]})})]}),e.jsx(Z,{open:B,onOpenChange:u,children:e.jsxs(ee,{className:"max-w-2xl",children:[e.jsxs(se,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[l&&z(l.status),l?.title]}),e.jsx(ae,{children:"Action item details and progress tracking"})]}),l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Status:"}),e.jsx(r,{variant:l.status==="completed"?"default":"secondary",children:l.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Priority:"}),e.jsx(r,{variant:"outline",className:O[l.priority],children:l.priority})]})]}),l.due_date&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Due: ",new Date(l.due_date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:l.description})]}),l.context&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Context"}),e.jsx("p",{className:"text-sm text-gray-600 italic",children:l.context})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(V,{className:"h-4 w-4 text-blue-600"}),e.jsx("h4",{className:"text-sm font-medium text-blue-900",children:"Related Module"})]}),e.jsx("p",{className:"text-sm text-blue-800",children:a.title}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:a.description})]})]}),e.jsxs(le,{children:[e.jsx(h,{variant:"outline",onClick:F,children:"Close"}),l?.status!=="completed"&&e.jsx(h,{onClick:J,disabled:A,children:A?"Updating...":"Mark as Completed"})]})]})})]})}export{De as default};
