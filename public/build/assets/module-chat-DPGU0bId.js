import{r as c,u as J,j as e,H as R,L as q,c as Y}from"./app-3FspBjTR.js";import{A as K,M as Z}from"./app-layout-CjrmdGQI.js";import{a as j,B as x}from"./app-logo-icon-BLQzeAhD.js";import{C as m,a as p,c as h,b as u,d as E,B as n}from"./badge-vIQQGWNV.js";import{T as G,a as Q,b as I,c as M}from"./tabs-20ObluVx.js";import{D as W,a as X,b as ee,c as se,d as te,e as ae}from"./dialog-BR9hboG2.js";import{C as V}from"./clock-DwJkVMOQ.js";import{T as w}from"./target-B9W287Xc.js";import{B as L}from"./book-open-CoYo77vB.js";import{m as le}from"./proxy-B0jY-HJA.js";import{C as ie}from"./circle-check-big-DSp4QR63.js";/* empty css            */import"./index-F970KQGr.js";import"./index-CJYJTZPg.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ne=j("ArrowLeft",ce);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],oe=j("CircleAlert",re);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],xe=j("Circle",de);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]],pe=j("Mic",me),he={coaching:"bg-green-100 text-green-800",training:"bg-yellow-100 text-yellow-800",assessment:"bg-blue-100 text-blue-800"},fe={beginner:"bg-emerald-100 text-emerald-800",intermediate:"bg-amber-100 text-amber-800",advanced:"bg-red-100 text-red-800"},B={low:"bg-blue-100 text-blue-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-red-100 text-red-800"},O=a=>{switch(a){case"completed":return e.jsx(ie,{className:"h-4 w-4 text-green-500"});case"in_progress":return e.jsx(oe,{className:"h-4 w-4 text-yellow-500"});default:return e.jsx(xe,{className:"h-4 w-4 text-gray-400"})}};function Ae({module:a,user:s,actionItems:_=[]}){const[l,v]=c.useState(null),[z,f]=c.useState(!1),[C,r]=c.useState(!1),[o,k]=c.useState("voiceflow"),H=c.useRef(null),{props:P}=J(),y=P.flash?.success;c.useEffect(()=>{y&&console.log("Success:",y)},[y]);const $=t=>{v(t),f(!0)},U=()=>{f(!1),v(null),r(!1)},F=()=>{l&&(r(!0),Y.put(`/action-items/${l.id}/complete`,{},{preserveState:!1,preserveScroll:!0,onSuccess:t=>{f(!1),v(null),r(!1),console.log("Action item marked as completed successfully")},onError:t=>{console.error("Failed to update action item:",t),alert("Failed to update action item. Please try again."),r(!1)},onFinish:()=>{r(!1)}}))};c.useEffect(()=>{if(!document.querySelector('script[src*="convai-widget-embed"]')){const t=document.createElement("script");t.src="https://unpkg.com/@elevenlabs/convai-widget-embed",t.async=!0,t.type="text/javascript",document.head.appendChild(t)}},[]);const N={user_profile:JSON.stringify({id:s?.id||0,name:s?.name||"Anonymous",email:s?.email||"",role:s?.role||"member",pi_behavioral_pattern_id:s?.pi_behavioral_pattern_id||null,pi_behavioral_pattern:s?.pi_behavioral_pattern||null,pi_raw_scores:s?.pi_raw_scores||null,pi_assessed_at:s?.pi_assessed_at||null,pi_notes:s?.pi_notes||null,pi_profile:s?.pi_profile||null,has_pi_assessment:s?.has_pi_assessment||!1,has_pi_profile:s?.has_pi_profile||!1}),user_name:s?.name?s.name.split(" ")[0]:"Anonymous"};return console.log("ðŸš€ ElevenLabs Variables Structure:",N),console.log("ðŸš€ ElevenLabs Final JSON:",JSON.stringify(N)),c.useEffect(()=>{const t=()=>{setTimeout(()=>{console.log("Starting Voiceflow initialization...");const b=document.getElementById("btcs-chat");console.log("Chat element found:",b),function(S,D){const d=S.createElement(D),T=S.getElementsByTagName(D)[0];d.onload=function(){if(console.log("Voiceflow script loaded, window.voiceflow:",window.voiceflow),window.voiceflow&&window.voiceflow.chat){const i=document.getElementById("btcs-chat");console.log("Target element for Voiceflow:",i);const A={id:s?.id||0,name:s?.name||"Anonymous",email:s?.email||"",role:s?.role||"member",pi_behavioral_pattern_id:s?.pi_behavioral_pattern_id||null,pi_behavioral_pattern:s?.pi_behavioral_pattern||null,pi_raw_scores:s?.pi_raw_scores||null,pi_assessed_at:s?.pi_assessed_at||null,pi_notes:s?.pi_notes||null,pi_profile:s?.pi_profile||null,has_pi_assessment:s?.has_pi_assessment||!1,has_pi_profile:s?.has_pi_profile||!1};console.log("ðŸš€ Voiceflow User Payload:",JSON.stringify(A,null,2)),window.voiceflow.chat.load({verify:{projectID:"686331bc96acfa1dd62f6fd5"},url:"https://general-runtime.voiceflow.com",versionID:"production",voice:{url:"https://runtime-api.voiceflow.com"},render:{mode:"embedded",target:i},assistant:{stylesheet:"/voiceflow.css?v="+new Date().toISOString().replace(/[:.]/g,"-")},autostart:!0,launch:{event:{type:"launch",payload:A}}}),console.log("Voiceflow chat loaded for module:",a.title)}else{console.error("Voiceflow widget failed to load - missing window.voiceflow");const i=document.getElementById("btcs-chat");i&&(i.innerHTML=`
                                    <div class="flex items-center justify-center h-full text-gray-500">
                                        <div class="text-center">
                                            <p class="text-lg font-medium text-red-600 mb-2">Chat Temporarily Unavailable</p>
                                            <p class="text-sm">Please refresh the page or try again later.</p>
                                            <p class="text-xs mt-2 text-gray-400">Error: Voiceflow widget failed to initialize</p>
                                        </div>
                                    </div>
                                `)}},d.onerror=function(){console.error("Failed to load Voiceflow script from CDN");const i=document.getElementById("btcs-chat");i&&(i.innerHTML=`
                                <div class="flex items-center justify-center h-full text-gray-500">
                                    <div class="text-center">
                                        <p class="text-lg font-medium text-red-600 mb-2">Chat Service Unavailable</p>
                                        <p class="text-sm">Unable to connect to chat service.</p>
                                        <p class="text-xs mt-2 text-gray-400">Please contact support if this issue persists.</p>
                                    </div>
                                </div>
                            `)},d.src="https://cdn.voiceflow.com/widget-next/bundle.mjs",d.type="text/javascript",console.log("Adding Voiceflow script to DOM..."),T.parentNode?.insertBefore(d,T)}(document,"script")},100),console.log("Voiceflow initialization started for module:",a.title)},g=()=>{if(window.voiceflow&&window.voiceflow.chat)try{window.voiceflow.chat.destroy(),console.log("Voiceflow chat destroyed")}catch(b){console.warn("Error cleaning up Voiceflow:",b)}};return g(),t(),g},[a,s]),e.jsxs(K,{children:[e.jsx(R,{title:`${a.title} - Interactive Session`}),e.jsxs("div",{className:"flex gap-6",style:{height:"calc(100vh - 200px)"},children:[e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx(q,{href:"/modules",children:e.jsxs(x,{variant:"outline",size:"sm",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),"Back to Modules"]})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:a.title}),e.jsx("p",{className:"text-sm text-gray-600",children:"Interactive Coaching Session"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"outline",size:"sm",children:"Save Progress"}),e.jsx(x,{variant:"outline",size:"sm",children:"End Session"})]})]}),e.jsxs(m,{className:"flex-1 flex flex-col py-0",style:{minHeight:"500px",maxHeight:"calc(100vh - 280px)"},children:[e.jsx(p,{className:"py-3 px-4 border-b",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("button",{onClick:()=>k("voiceflow"),className:`inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${o==="voiceflow"?"bg-blue-100 text-blue-700 border-blue-200 border":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Z,{className:"h-4 w-4"}),"Text Chat"]}),e.jsxs("button",{onClick:()=>k("elevenlabs"),className:`inline-flex items-center gap-2 px-3 py-2 text-sm font-medium rounded-lg transition-colors ${o==="elevenlabs"?"bg-green-100 text-green-700 border-green-200 border":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(pe,{className:"h-4 w-4"}),"Voice Chat"]})]}),e.jsx("div",{className:"text-sm text-gray-500 ml-auto",children:o==="voiceflow"?"Text-based coaching conversation":"Voice-based AI coaching"})]})}),e.jsxs(h,{className:"p-0 flex-1 relative",children:[e.jsx("div",{id:"btcs-chat",className:`w-full h-full ${o==="voiceflow"?"block":"hidden"}`,style:{maxHeight:"calc(100vh - 200px)"},children:e.jsx("div",{className:"flex items-center justify-center h-full text-gray-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-pulse",children:e.jsx("div",{className:"w-8 h-8 bg-blue-200 rounded-full mx-auto mb-4"})}),e.jsx("p",{children:"Initializing your coaching session..."}),e.jsx("p",{className:"text-sm mt-2",children:"Your AI coach will appear here shortly."})]})})}),o==="elevenlabs"&&e.jsx("div",{className:"w-full h-full",children:e.jsx("div",{className:"w-full h-full relative",children:e.jsx("elevenlabs-convai",{ref:H,"agent-id":"agent_0901k31ke64mf0w8me1gdwygb7ze","dynamic-variables":JSON.stringify(N),style:{position:"relative",width:"100%",height:"100%",display:"block"}})})})]})]})]}),e.jsx("div",{className:"w-80",children:e.jsxs(G,{defaultValue:"info",className:"w-full",children:[e.jsxs(Q,{className:"grid w-full grid-cols-2",children:[e.jsx(I,{value:"info",children:"Info"}),e.jsx(I,{value:"actions",children:"Actions"})]}),e.jsxs(M,{value:"info",className:"space-y-4 mt-4",children:[e.jsxs(m,{children:[e.jsxs(p,{className:"pb-3",children:[e.jsx(u,{className:"text-lg",children:a.title}),e.jsx(E,{className:"text-sm",children:a.description})]}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(n,{className:he[a.type],children:a.type}),e.jsx(n,{variant:"outline",className:fe[a.difficulty],children:a.difficulty})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-500",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsxs("span",{children:[a.estimated_duration," minutes"]})]})]})]}),e.jsxs(m,{children:[e.jsx(p,{className:"pb-3",children:e.jsxs(u,{className:"flex items-center gap-2 text-lg",children:[e.jsx(w,{className:"h-5 w-5"}),"Session Overview"]})}),e.jsxs(h,{className:"space-y-4",children:[a.topics&&a.topics.length>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(L,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Key Topics:"})]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:a.topics.map((t,g)=>e.jsx(n,{variant:"secondary",className:"text-xs",children:t},g))})]}),a.learning_objectives&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Learning Objectives:"})]}),e.jsx("p",{className:"text-sm text-gray-600 leading-relaxed",children:a.learning_objectives})]})]})]}),e.jsxs(m,{children:[e.jsx(p,{className:"pb-3",children:e.jsx(u,{className:"text-lg",children:"Session Progress"})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Status"}),e.jsx("span",{className:"font-medium text-green-600",children:"In Progress"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Started"}),e.jsx("span",{className:"font-medium",children:"Just now"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Estimated Time"}),e.jsxs("span",{className:"font-medium",children:[a.estimated_duration," min"]})]})]})})]})]}),e.jsx(M,{value:"actions",className:"space-y-4 mt-4",children:e.jsxs(m,{children:[e.jsxs(p,{className:"pb-3",children:[e.jsx(u,{className:"text-lg",children:"Module Action Items"}),e.jsxs(E,{className:"text-sm",children:["Your personalized tasks and objectives for ",a.title]})]}),e.jsx(h,{children:_.length===0?e.jsxs("div",{className:"text-center py-6 text-gray-500",children:[e.jsx(w,{className:"h-8 w-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm",children:"No action items for this module yet"}),e.jsx("p",{className:"text-xs mt-1",children:"Complete coaching sessions to generate personalized tasks"})]}):e.jsx("div",{className:"space-y-3",children:_.map(t=>e.jsxs(le.div,{className:"border rounded-lg p-3 space-y-2 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>$(t),whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsxs("div",{className:"flex items-start gap-2",children:[O(t.status),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:t.title}),e.jsx("p",{className:"text-xs text-gray-600 mt-1 line-clamp-2",children:t.description})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(n,{variant:"outline",className:`text-xs ${B[t.priority]}`,children:t.priority}),t.due_date&&e.jsxs("span",{className:"text-xs text-gray-500",children:["Due ",new Date(t.due_date).toLocaleDateString()]})]}),t.context&&e.jsx("div",{className:"text-xs text-gray-500 italic truncate",children:t.context})]},t.id))})})]})})]})})]}),e.jsx(W,{open:z,onOpenChange:f,children:e.jsxs(X,{className:"max-w-2xl",children:[e.jsxs(ee,{children:[e.jsxs(se,{className:"flex items-center gap-2",children:[l&&O(l.status),l?.title]}),e.jsx(te,{children:"Action item details and progress tracking"})]}),l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Status:"}),e.jsx(n,{variant:l.status==="completed"?"default":"secondary",children:l.status.replace("_"," ")})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Priority:"}),e.jsx(n,{variant:"outline",className:B[l.priority],children:l.priority})]})]}),l.due_date&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-700",children:["Due: ",new Date(l.due_date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:l.description})]}),l.context&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Context"}),e.jsx("p",{className:"text-sm text-gray-600 italic",children:l.context})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(L,{className:"h-4 w-4 text-blue-600"}),e.jsx("h4",{className:"text-sm font-medium text-blue-900",children:"Related Module"})]}),e.jsx("p",{className:"text-sm text-blue-800",children:a.title}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:a.description})]})]}),e.jsxs(ae,{children:[e.jsx(x,{variant:"outline",onClick:U,children:"Close"}),l?.status!=="completed"&&e.jsx(x,{onClick:F,disabled:C,children:C?"Updating...":"Mark as Completed"})]})]})})]})}export{Ae as default};
